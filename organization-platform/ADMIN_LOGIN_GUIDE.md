# Admin Login Setup Guide

## Current Setup Status

✅ Development server running at: http://localhost:3000
✅ Admin login page accessible at: http://localhost:3000/admin/login
✅ Environment variables configured (.env.local)
✅ Supabase client configured

## Login Credentials

### Development Superadmin (from COMPLETE_SETUP.sql)
- **Email:** `abdulssekyanzi@gmail.com`
- **Password:** `Su4at3#0`

### Default Test Admin (if setup script was run)
- **Email:** `admin@southern.org`
- **Password:** `admin123`

## Setup Steps (If Not Already Done)

### 1. Run Database Setup Script

You need to run the complete setup SQL script in your Supabase project:

1. Go to: https://app.supabase.com/project/qvdacaasudthvrsqiwcz/sql/new
2. Copy the contents of `lib/supabase/COMPLETE_SETUP.sql`
3. Paste into the SQL Editor
4. Click "Run" to execute
5. Verify with `lib/supabase/VERIFY_SETUP.sql`

### 2. Verify Database Setup

Run this query in Supabase SQL Editor to check if the setup is complete:

```sql
-- Check if admins table exists
SELECT EXISTS (
  SELECT FROM information_schema.tables 
  WHERE table_schema = 'public' 
  AND table_name = 'admins'
);

-- Check if any admins exist
SELECT email, full_name, is_active 
FROM admins 
WHERE is_active = true;

-- Check total tables
SELECT COUNT(*) as table_count 
FROM information_schema.tables 
WHERE table_schema = 'public';

-- Check storage buckets
SELECT name, public 
FROM storage.buckets 
ORDER BY name;
```

### 3. Create Admin Manually (Alternative Method)

If the SQL script hasn't been run, create an admin manually:

```sql
-- Insert a test admin
INSERT INTO admins (full_name, email, password_hash, phone_number, is_active)
VALUES (
  'Test Admin',
  'admin@southern.org',
  -- Password hash for 'admin123' using SHA-256
  '240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9',
  '+256 700 000000',
  true
);
```

### 4. Troubleshooting Login Issues

#### Issue: "Invalid email or password"

**Possible Causes:**
1. Database not set up (admins table doesn't exist)
2. No admin users created in the database
3. Password hash mismatch
4. Supabase connection issue

**Solutions:**
1. Run COMPLETE_SETUP.sql in Supabase
2. Check browser console (F12) for errors
3. Verify Supabase credentials in .env.local
4. Ensure Supabase project is active

#### Issue: Login page loads but nothing happens on submit

**Possible Causes:**
1. JavaScript errors in browser console
2. Supabase client configuration issue
3. CORS policy blocking requests

**Solutions:**
1. Open browser DevTools (F12) and check Console tab
2. Verify NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY
3. Check Network tab for failed API requests
4. Restart dev server after .env.local changes

#### Issue: Redirects to login immediately after successful login

**Possible Causes:**
1. Admin session not being stored
2. Layout.tsx authentication check failing
3. Browser blocking localStorage/sessionStorage

**Solutions:**
1. Check browser console for storage errors
2. Try a different browser or incognito mode
3. Clear browser cache and cookies
4. Verify Zustand store is working

## Testing the Login Flow

1. **Navigate to login page:**
   ```
   http://localhost:3000/admin/login
   ```

2. **Enter credentials:**
   - Email: `abdulssekyanzi@gmail.com`
   - Password: `Su4at3#0`
   
   OR (if default test admin exists):
   - Email: `admin@southern.org`
   - Password: `admin123`

3. **Expected behavior:**
   - Loading spinner appears
   - Success notification shows
   - Redirect to `/admin/dashboard`
   - Dashboard loads with navigation sidebar

4. **Check console for errors:**
   - Press F12 to open DevTools
   - Look at Console tab for any red errors
   - Check Network tab for failed requests

## Password Hash Reference

The system uses SHA-256 hashing for passwords. Here are some pre-generated hashes:

- `admin123` → `240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9`
- `Su4at3#0` → Hash generated by COMPLETE_SETUP.sql script

## Quick Verification Commands

### In Browser Console (F12):
```javascript
// Check if Supabase is configured
console.log('Supabase URL:', process.env.NEXT_PUBLIC_SUPABASE_URL);

// Check localStorage for admin session
console.log('Admin stored:', localStorage.getItem('admin-storage'));

// Test Supabase connection
fetch('https://qvdacaasudthvrsqiwcz.supabase.co/rest/v1/')
  .then(r => console.log('Supabase reachable:', r.status))
  .catch(e => console.error('Supabase error:', e));
```

### In Supabase Dashboard:
1. Go to: Table Editor
2. Look for `admins` table
3. Check if any rows exist
4. Verify `is_active = true` for at least one admin

## Common Errors and Solutions

### Error: "Failed to fetch"
- **Cause:** Network/CORS issue or wrong Supabase URL
- **Fix:** Check NEXT_PUBLIC_SUPABASE_URL in .env.local

### Error: "relation 'admins' does not exist"
- **Cause:** Database tables not created
- **Fix:** Run COMPLETE_SETUP.sql in Supabase SQL Editor

### Error: "Invalid JWT"
- **Cause:** Wrong SUPABASE_ANON_KEY
- **Fix:** Copy correct anon key from Supabase project settings

### Error: "hash_password function not found"
- **Cause:** SQL function not created
- **Fix:** Run COMPLETE_SETUP.sql which includes the function

## Next Steps After Successful Login

Once logged in, you should see:
1. ✅ Admin Dashboard with navigation sidebar
2. ✅ Top bar showing your name and email
3. ✅ Logout button in top-right corner
4. ✅ Access to all admin pages (slides, gallery, programs, etc.)

## Need More Help?

1. Check browser console (F12 → Console tab)
2. Review Supabase logs (Project → Logs → Database)
3. Verify environment variables are loaded (restart server after changes)
4. Check this documentation: COMPLETE_PROJECT_SETUP.md
